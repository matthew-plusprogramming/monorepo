{
  "sequences": [
    {
      "name": "build-deploy-api-lambda",
      "description": "Build and deploy the API lambda.",
      "steps": [
        "npm -w node-server run decrypt-envs",
        "node scripts/cdk.mjs deploy myapp-api-lambda-stack --auto-approve",
        "npm -w node-server run encrypt-envs"
      ]
    },
    {
      "name": "deploy-infra",
      "description": "Deploy all infrastructure stacks (api-stack, analytics-stack).",
      "steps": [
        "node scripts/cdk.mjs deploy infra --auto-approve"
      ]
    },
    {
      "name": "deploy-lambdas",
      "description": "Build and deploy all Lambda stacks.",
      "steps": [
        "node scripts/cdk.mjs deploy lambdas --auto-approve"
      ]
    },
    {
      "name": "full-deploy",
      "description": "Full deployment: build everything, deploy all stacks in order.",
      "steps": [
        "node scripts/cdk.mjs prepare",
        "node scripts/cdk.mjs deploy all --auto-approve"
      ]
    },
    {
      "name": "clean-and-deploy",
      "description": "Clean rebuild followed by full deployment.",
      "steps": [
        "npm run clean",
        "npm i",
        "node scripts/cdk.mjs prepare",
        "node scripts/cdk.mjs deploy all --auto-approve",
        "npm run test"
      ]
    },
    {
      "name": "refresh-outputs",
      "description": "Pull fresh outputs from all deployed infrastructure stacks.",
      "steps": [
        "node scripts/cdk.mjs outputs infra"
      ]
    }
  ]
}
